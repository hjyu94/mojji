<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:include="fragments.html :: basic-head"></th:block>
    <th:block th:include="fragments.html :: navbar-head"></th:block>
    <style>
        .text {
            -o-text-overflow: ellipsis;   /* Opera */
            text-overflow:    ellipsis;   /* IE, Safari (WebKit) */
            overflow:hidden;              /* don't show excess chars */
            white-space:nowrap;           /* force single line */
            width: 300px;                 /* fixed width */
        }
        .thumbnail {
            width: 100%;
            height: 200px;
        }
    </style>
</head>
<body>
<div id="register-email-alert" style="margin-bottom: 0px" class="fixed-top row justify-content-center align-self-center alert alert-warning" th:if="${account != null && !account.emailVerified}">
    모찌 가입을 완료하려면&nbsp;<a href="#" th:href="@{/account/confirm-email}" class="alert-link">계정 인증 이메일을 확인</a>하세요.
</div>
<nav th:replace="fragments.html :: main-nav"></nav>
<main role="main">
    <div class="jumbotron">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-7 align-self-center text-center">
                    <h4 class="h1 mb-4">편리한 중고 거래</h4>
                    <p class="font-weight-normal">
                        중고거래 시작은 모찌마켓에서!<br/>
                        동네 주민들과 가깝고 따뜻한 거래를 경험해보세요.<br/>
                        지역과 카테고리를 설정해두면 새 글이 등록될 때 알림을 받으실 수 있습니다.<br/>
                        반응형 웹 페이지로 핸드폰, 태블릿, PC에서 모두 편하게 사용하세요!
                    </p>
                    <div sec:authorize="!isAuthenticated()" class="row justify-content-center my-2">
                        <span data-toggle="tooltip" data-placement="bottom" title="회원 가입 후 모찌 서비스를 마음껏 이용하세요">
                            <a class="mx-1 btn btn-primary text-white" th:href="@{/new-account}">회원 가입</a>
                        </span>
                        <span data-toggle="tooltip" data-placement="bottom" title="로그인 창으로 이동합니다.">
                            <a class="mx-1 btn btn-danger text-white" th:href="@{/login}">로그인</a>
                        </span>
                    </div>
                    <div sec:authorize="isAuthenticated()" class="row justify-content-center my-2">
                        <span data-toggle="tooltip" data-placement="bottom" title="판매를 시작해보세요!">
                            <a class="mx-1 btn btn-primary text-white" th:href="@{/new-post}">판매글 등록하기</a>
                        </span>
                    </div>
                </div>
                <div class="col-md-5 offset">
                    <div class="view overlay">
                        <img src="/images/shopping.png" style="max-width: 100%; height:auto;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-5">
        <div sec:authorize="!isAuthenticated()">
            <h2 class="text-center">최신글</h2>
            <hr class="text-center col-1 my-5 text-success"/>
            <div class="row">
                <div class="col-md-4" th:each="post : ${posts}">
                    <div class="card mb-4 shadow-sm">
                        <a th:href="@{'/post/' + ${post.getId()}}">
                            <img class="thumbnail card-img-top"
                                 th:if="${#lists.isEmpty(post.getImgFileNames())}"
                                 src="/images/no-image-icon.PNG"
                                 alt="Deafult Image">
                            <img class="thumbnail card-img-top"
                                 th:if="${!#lists.isEmpty(post.getImgFileNames())}"
                                 th:src='${"/displayFile?post-id=" + post.getId() + "&fileName=s_" + post.getImgFileNames().get(0)}'
                                 th:alt="${'s_' + post.getImgFileNames().get(0)}">
                        </a>
                        <div class="card-body">
                            <a class="card-title font-weight-bold text" th:text="${post.title}" th:href="@{'/post/' + ${post.getId()}}">이동식 에어컨</a>
                            <p class="card-text text"><span th:each="station : ${post.stations}" th:text="${station.toString()}">평촌역</span></p>
                            <p class="card-text font-weight-bolder text" th:text="${post.price + '원'}">999원</p>
                        </div>
                        <div class="card-footer text-right">
                            <i class="fa fa-mouse-pointer" aria-hidden="true"></i>
                            <small th:text="${post.lookCount}"></small>
                             ∙ <i class="fa fa-envelope-o" aria-hidden="true"></i>
                            <small th:text="${post.letterCount}"></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div sec:authorize="isAuthenticated()">
            <h2 class="text-center">'평촌' '범계' 에 올라온 글</h2>
            ...
        </div>
        <div sec:authorize="isAuthenticated()">
            <h2 class="text-center">'전자제품' '도서' 에 올라온 글</h2>
            ...
        </div>
    </div>
</main>
<footer th:replace="fragments.html :: footer"></footer>
<th:block th:replace="fragments.html :: tooltip-script"></th:block>
<th:block th:replace="fragments.html :: basic-script"></th:block>
<script>
    window.onload = function(){
        var ele_nav = $('#mainNav');
        var ele_alert = $('#register-email-alert');
        var ele_main = $('main');
        var bottom_y_nav = parseInt(ele_nav.css("height"));
        var padding_y_alert = parseInt(ele_alert.css("padding-bottom"));
        var bottom_y_alert = bottom_y_nav;

        if (ele_alert.length > 0) {
            bottom_y_alert += parseInt(ele_alert.css("height"));
        }

        ele_alert.css('padding-top', bottom_y_nav + padding_y_alert);
        ele_main.css('padding-top', bottom_y_alert);
    }
</script>
</body>
</html>
